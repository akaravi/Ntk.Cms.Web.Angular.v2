<cron-editor [(cron)]="dataModel.scheduleCron" [disabled]="isCronDisabled" [options]="cronOptions"></cron-editor>
<h2 style="direction: ltr;">Resulting Cron: {{dataModel.scheduleCron}}</h2>
<form (ngSubmit)="onFormSubmit()" #vform="ngForm">
  <div class="ntk-cms-html-card-header">
    <!--begin:::::::::::::::::::::::::::::::::::::::::cms-header-->
    {{ formInfo.formTitle }}
    <!--end:::::::::::::::::::::::::::::::::::::::::cms-header-->
  </div>
  <div class="ntk-cms-html-card-body">
    <app-progress-spinner [options]="loading"> </app-progress-spinner>
    <!--begin:::::::::::::::::::::::::::::::::::::::::cms-body-->
    <div class="row">

      <div class="col-6">
        <mat-tab-group mat-stretch-tabs class="example-stretched-tabs mat-elevation-z4">


          <mat-tab label="مسیر" dynamicHeight>
            <!-- LinkPrivateSiteConfigId Field -->
            <app-sms-apipath-selector (optionChange)="onActionSelectPrivateSiteConfig($event)" [loading]="loading"
              [optionSelectForce]="dataModel.linkApiPathId" [optionPlaceholder]="' مسیر'"
              [optionSelectFirstItem]="true">
            </app-sms-apipath-selector>
            <app-sms-api-number-selector *ngIf="dataModel.linkApiPathId?.length>0" [loading]="loading"
              (optionChange)="onActionSelectApiNumber($event)" [optionSelectForce]=""
              [optionLinkApiPathId]="dataModel.linkApiPathId" [optionPlaceholder]="' شماره فرستنده'"
              [optionSelectFirstItem]="true">
            </app-sms-api-number-selector>
          </mat-tab>
          <mat-tab label="پیام ها">
            <app-sms-main-message-category-selector (optionChange)="onActionSelectMessageCategory($event)">
            </app-sms-main-message-category-selector>
            <app-sms-main-message-content-selector (optionChange)="onActionSelectMessageContent($event)"
              [optionLinkCategryId]="dataMessageCategoryModel.id"></app-sms-main-message-content-selector>

            <textarea matInput [(ngModel)]="dataMessageContentModel.messageBody"
              name="dataMessageContentModel.messageBody" type="text"
              *ngIf="dataMessageContentModel?.messageBody?.length>0" rows="10"></textarea>
            <button type="button" (click)="onActionMessageContentAdd()" class="btn btn-light"
              *ngIf="dataMessageContentModel?.messageBody?.length>0 && dataModel.message?.length>0">
              <i class="ft-x"></i> اضافه به متن
            </button>
            <button type="button" (click)="onActionMessageContentNew()" class="btn btn-light"
              *ngIf="dataMessageContentModel?.messageBody?.length>0">
              <i class="ft-x"></i> متن پیام
            </button>
          </mat-tab>
          <mat-tab label="مخاطب">
            <app-cms-contact-category-tree-selector (optionSelectChecked)="onActionContactCategorySelectChecked($event)"
              (optionSelectDisChecked)="onActionContactCategorySelectDisChecked($event)">
            </app-cms-contact-category-tree-selector>

          </mat-tab>
          <mat-tab label="زمان ارسال">
            <!-- scheduleSend Field -->
            <mat-form-field class="ntk-full-width">
              <mat-label>تاریخ ارسال</mat-label>
              <input matInput [matDatepicker]="scheduleSendDate" [(ngModel)]="dataModelDateByClock.date"
                name="scheduleSendDate" />
              <mat-icon matSuffix *ngIf="scheduleSendDate" matSuffix mat-icon-button aria-label="Clear"
                (click)="onActionMessageContentNew()">close</mat-icon>
              <mat-datepicker-toggle matSuffix [for]="scheduleSendDate"></mat-datepicker-toggle>
              <mat-datepicker touchUi #scheduleSendDate (closed)="onActionScheduleSendCheck()"></mat-datepicker>
              <mat-icon matTooltip="زمان ارسال پیام" matSuffix>info</mat-icon>
            </mat-form-field>

            <!-- scheduleSendClock Field -->
            <mat-form-field class="ntk-full-width">
              <mat-label>ساعت ارسال</mat-label>
              <input matInput [ngxTimepicker]="scheduleSendClock" [(ngModel)]="dataModelDateByClock.clock" [format]="24"
                name="scheduleSendClock" />
              <mat-icon matSuffix mat-icon-button aria-label="Clear" (click)="onActionMessageContentNew()">
                close</mat-icon>
              <ngx-material-timepicker-toggle matSuffix [for]="scheduleSendClock"></ngx-material-timepicker-toggle>
              <ngx-material-timepicker touchUi #scheduleSendClock (closed)="onActionScheduleSendCheck()">
              </ngx-material-timepicker>
            </mat-form-field>

            {{dataModel.scheduleSend | persianDateFull}}

            <hr>
            {{this.dataModel.scheduleSend}}
            
            <br>
            <h2 style="direction: ltr;">Resulting Cron: {{dataModel.scheduleCron}}</h2>
          </mat-tab>
          <mat-tab label="تنظیمات">
            <!-- IsFlash Field -->
            <div class="ntk-full-width">
              <mat-slide-toggle [(ngModel)]="dataModel.isFlash" name="dataModel.isFlash">
                ارسال به صورت فلش
              </mat-slide-toggle>
            </div>
            <!-- SendByQeue Field -->
            <div class="ntk-full-width">
              <mat-slide-toggle [(ngModel)]="dataModel.sendByQeue" name="dataModel.sendByQeue">
                ارسال در صف
              </mat-slide-toggle>
            </div>
          </mat-tab>

        </mat-tab-group>

      </div>
      <div class="col-3">






        <!-- Message Field -->
        <mat-form-field class="ntk-full-width">
          <mat-label>متن پیام</mat-label>
          <textarea matInput [(ngModel)]="dataModel.message" name="dataModel.message" #Message type="text"
            placeholder="..." minlength="1" maxlength="500" rows="5"></textarea>
          <mat-icon matSuffix *ngIf="dataModel.message" matSuffix mat-icon-button aria-label="Clear"
            (click)="dataModel.message = ''">close</mat-icon>
          <mat-icon matSuffix>mode_edit</mat-icon>
          <mat-hint style="text-align: left;">{{ Message.value.length }} / 500</mat-hint>
          <mat-error *ngIf="Message.errors?.required">
            متن پیام <strong>{{'MESSAGE.required' | translate}}</strong>
          </mat-error>
        </mat-form-field>
        <!-- ToNumbers Field -->
        <mat-form-field class="ntk-full-width"
          *ngIf="(!this.dataModel.toContactCategories ||this.dataModel.toContactCategories?.length == 0) && (!this.dataModel.toContactContents||this.dataModel.toContactContents?.length == 0)">
          <mat-label>شماره گیرنده</mat-label>
          <textarea matInput [(ngModel)]="dataModel.toNumbers" name="dataModel.toNumbers" #ToNumbers type="text"
            placeholder="0912" rows="5"></textarea>
          <mat-icon matSuffix *ngIf="dataModel.toNumbers" matSuffix mat-icon-button aria-label="Clear"
            (click)="dataModel.toNumbers = ''">close</mat-icon>
          <mat-icon matSuffix>mode_edit</mat-icon>
          <mat-hint style="text-align: right;">
            <mat-icon matSuffix class="info-field-icon">info</mat-icon>
            <strong class="info-field-text">شماره گیرنده پیام را می توانید با کاما از هم جدا کنید</strong>
          </mat-hint>
          <mat-hint style="text-align: left;">{{ ToNumbers.value.length }} / 500</mat-hint>
        </mat-form-field>

      </div>
    </div>
    <app-cms-json-list [dataModel]="dataModelResult.item" [optionMethod]="1" *ngIf="dataModelResult?.item">
    </app-cms-json-list>
    
    <!--end:::::::::::::::::::::::::::::::::::::::::cms-body-->
  </div>
  <div class="ntk-cms-html-card-message">
    <!--begin:::::::::::::::::::::::::::::::::::::::::cms-message-->
    <div class="form-actions">
      <small class="form-text text-muted">{{ formInfo.formAlert }} </small>
      <small class="form-text text-muted danger">{{ formInfo.formError }}
      </small>
    </div>
    <!--end:::::::::::::::::::::::::::::::::::::::::cms-message-->
  </div>
  <div class="ntk-cms-html-card-footer">
    <!--begin:::::::::::::::::::::::::::::::::::::::::cms-footer-->
    <app-progress-spinner [options]="loadingAction"> </app-progress-spinner>
    <div class="form-actions" *ngIf="formInfo.formSubmitAllow  && !loading.display">
      <button type="button" (click)="onFormCancel()" class="btn btn-light">
        <i class="ft-x"></i> {{'ACTION.CANCEL' | translate}}
      </button>
      <button type="submit" (click)="onFormSubmit()" class="btn btn-success" [disabled]="!vform.valid"
        *ngIf="!this.loading.display">
        <i class="fa fa-check-square-o"></i>
        {{'ACTION.Send_Message' | translate}}
      </button>

    </div>
    <!--end:::::::::::::::::::::::::::::::::::::::::cms-footer-->
  </div>
</form>